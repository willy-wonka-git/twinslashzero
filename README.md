# TASK

[![Build Status](https://app.travis-ci.com/willy-wonka-git/twinslashzero.svg?branch=main)](https://app.travis-ci.com/willy-wonka-git/twinslashzero) ![GitHub language count](https://img.shields.io/github/languages/count/willy-wonka-git/twinslashzero?style=social) ![License](https://img.shields.io/badge/license-MIT%20license-blue)

[Task](https://docs.google.com/document/d/1390ZczB-uCVaH0bsxH0qKALk1YQAeK9yta7LalW1hvo/edit#heading=h.800vgi95v9ga)

[Demo](https://blooming-journey-21325.herokuapp.com/)


1. На страницах где отображается список постов вот такая ошибка:  
   *Рекомендую пересоздать базу (db:seed). Ошибка из-за плохого обновления, поскольку явно сохранилась бесполезная колонка после гема Сarrierwave.  
    Постараюсь в дальнейшем не использовать роллбэки, если изменения были опубликованы.  
    Детали: Carrierwave не дружит с Ransack без корректировки. В post уже не должно быть колонки с типом json, поскольку гем не используется.     
    Если все же понадобится, то тип надо поменять на jsonb, потому что операции сравнения в postgresql c json не работают.* 
    
2. Все еще отображается posts 4 - при том что ни одного поста нету:  
    *Рекомендую очистить кэш браузера и пересоздать\почистить базу, потому что у админа постов не должно быть, он не может их создавать.    
    Количество постов просто @posts.count и откуда расхождение - не понятно.*

3. ! Если при редактировании профиля, вылетит ошибка валидации, то ломается превью аватрки:    
    *Не знаю как исправить. [Метод](https://stackoverflow.com/questions/50360307/active-storage-best-practice-to-retain-cache-uploaded-file-when-form-redisplays) не помогает. А кэширование без пользователя под devise для меня пока проблематично.*

4. Через админку, я смог админом удалить самого себя, при том что других админов там нету:  
    *Исправил.     
    Админы больше не могут удалить себя или пользователя "admin" (он используется для периодических задач)*

5. При создании поста аналогично с профилем пользователя, если есть ошибки валидаций, то ломается превью картинок, и если после этого заполнить правильно невалидное поле и нажать сохранить - картинки просто пропадут, их не будет в создавшемся посте:  
    *Исправил. Проблема только в порядке добавления. Последние добавленные идут в начале списка, поскольку кэш хранится отдельно и подтаскивается после прохождения валидации.*
